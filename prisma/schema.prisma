generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


model User {
  id               String    @id
  username         String
  blameArchives    Archive[] @relation("BlamerArchives")
  unblamerArchives Archive[] @relation("UnblamerArchives")
  archives         Archive[] @relation("UserArchives")
  blames           Insult[]  @relation("BlamerInsults")
  insults          Insult[]  @relation("UserInsults")
}

model Insult {
  id        Int      @id
  guildId   String
  userId    String
  blamerId  String
  insult    String   @db.VarChar(100)
  note      String?  @db.VarChar(1000)
  createdAt DateTime @default(now())
  blamer    User     @relation("BlamerInsults", fields: [blamerId], references: [id])
  user      User     @relation("UserInsults", fields: [userId], references: [id])

  @@unique([guildId, id])
  @@index([guildId, userId])
  @@index([guildId, blamerId])
  @@index([guildId, insult])
}

model Setup {
  guildId          String   @id
  radarMode        String   @default("off") // "off", "blame", "delete", "both"
  createdAt        DateTime @default(now())
  blamerRoleId     String?
  frozenRoleId     String?
  insulterDays     Int      @default(0)
  insulterRoleId   String?
  insultsChannelId String?
  monitorChannelId String?
  updatedAt        DateTime @default(now()) @updatedAt
}

model Archive {
  id         Int      @id
  guildId    String
  userId     String
  blamerId   String
  insult     String   @db.VarChar(100)
  note       String?  @db.VarChar(1000)
  createdAt  DateTime
  unblamerId String
  unblamedAt DateTime @default(now())
  blamer     User     @relation("BlamerArchives", fields: [blamerId], references: [id])
  unblamer   User     @relation("UnblamerArchives", fields: [unblamerId], references: [id])
  user       User     @relation("UserArchives", fields: [userId], references: [id])

  @@unique([guildId, id])
  @@index([guildId, userId])
  @@index([guildId, blamerId])
  @@index([guildId, unblamerId])
  @@index([guildId, insult])
  @@index([guildId, createdAt, id])
}
